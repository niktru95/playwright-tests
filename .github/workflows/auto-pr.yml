name: Auto Create PR to Main

on:
  push:
    branches:
      - dev

permissions:
  contents: read
  pull-requests: write

jobs:
  create-pull-request:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check if PR exists
        id: check_pr
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          PR_COUNT=$(gh pr list --base main --head dev --json number --jq 'length')
          echo "pr_count=$PR_COUNT" >> $GITHUB_OUTPUT

      - name: Create Pull Request
        if: steps.check_pr.outputs.pr_count == '0'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr create \
            --base main \
            --head dev \
            --title "üöÄ Merge dev into main" \
            --body "## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Pull Request

          –≠—Ç–æ—Ç PR –±—ã–ª —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É \`dev\`.

          ### –ò–∑–º–µ–Ω–µ–Ω–∏—è
          - –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ commits –Ω–∏–∂–µ
          - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –ø–µ—Ä–µ–¥ –º–µ—Ä–¥–∂–µ–º

          ---
          _–°–æ–∑–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é GitHub Actions_"

